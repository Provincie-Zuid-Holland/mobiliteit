<!--URL parameter
regio : gem , c/{else} = concessies
ov /p:
live  :
haltes:
par   :
@     : coordinaten centrum of pointer
zoom  : zoom factor
i     : c=click 
pointer: marker met tekst op scher,
-->
 <!DOCTYPE html>
<html>
<head>
  <meta name="robots" content="noindex">
  <meta charset="UTF-8">
  <title>Zuid-Holland</title>
  <link rel=icon href="img/favicon.png">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="css/mapstyles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
<div id="map"></div>
<script src="scr/parseW.js"></script>
<script src="scr/mapFunctions.js"></script>
<script>
  console.log("start js")
  var Instellingen = {gemOpacity : 0.2 , gemFill : 0.07, popup : 9 } //globale vars voor kaarten; 
  Instellingen.legenda ={ logo: true } // logo: true


  function loadScript(scriptje) {
      const script = document.createElement('script');
          script.src = `${scriptje}.js`; // Dynamische bestandsnaam
          script.type = 'text/javascript';
          script.onload = () => { Instellingen[scriptje]   = 1;  } // zodat main de onload kan controleren                        
          document.body.appendChild(script);
  }
// *** Eerst URL parameters inlezen 
  const urlParams = new URLSearchParams(window.location.search);  
  if (urlParams.toString() === "") {   Instellingen.kaart = "home";
    } else {      // Voeg alle URL parameters toe aan Instellingen
    for (const [key, value] of urlParams.entries()) {
      let val = value;
      // optioneel: typeherkenning
      //if (val === "true") val = true;
      //else if (val === "false") val = false;
      //else if (!isNaN(val) && val.trim() !== "") val = Number(val);
      Instellingen[key] = val;
    }
  }
  console.log("Instellingen: ",Instellingen);
  var mapOptions = { center: [51.95, 4.584], zoom: 10 }
  if (urlParams.get('zoom') != null ){ mapOptions.zoom=urlParams.get('zoom')}
  const urlC = urlParams.get('@')  //mapcenter aanpassen + plek pointer
  if (urlC != null ){
    console.log(urlC)
    const myArray = urlC.split(",");
    mapOptions['center'] =  [Number(myArray[0]), Number(myArray[1])]
    if (myArray[2] !=null) {mapOptions['zoom'] =  Number(myArray[2])}
    if (myArray[3] !=null) {Instellingen["pointer"]=myArray[3]}
  }
  var map = new L.map('map', mapOptions);  createMap(); 

  if (urlParams.get('regio')) {  loadScript('data/gemeentesZH'); loadScript('data/gemDat') }  //gemeentekaart loaden;
  if (urlParams.get('ov') || urlParams.get('p') ){  loadScript('data/deelmdata');   }         //ov lijnen en deelmob loaden
  if (urlParams.get('live')  ){   loadScript('scr/api');  }                                   //load api
  if (urlParams.get('haltes')  ){ loadScript('data/haltesa');  }                              // haltes deelm potentie   
  if (urlParams.get('par')  ){  loadScript('scr/vierkant'); loadScript('data/vkdata4');  }    //load vierkant


 
  // *** Hier gaat het verder als overlays geladen zijn 
  function windowGeladen() {
    console.log("window geladen, instellingen: ");
    console.log(Instellingen)
    if (Instellingen['regio'] ){ 
      console.log("teken gemeentes!!!"); tekenGemeentes(); 
      if (Instellingen.regio == 'gem' ) { Instellingen.legenda.html = regioLegenda; } else { Instellingen.legenda.html = concessieLegenda;Instellingen.legenda.titel = 'OV concessies';Instellingen.legenda.minWidth='300px' }
    }

    if (Instellingen['ov'] ||Instellingen['p']  ){ plotOVLijnen(ovLijnen); }
    if (Instellingen.p == 'oranje' || Instellingen.p == 'os') {  mapOptions = { center: [51.95, 4.584], zoom: 10 };  console.log("start plot donkeys");  plotOVDonkeys(mapDonkeys); }
    if (Instellingen.p == 'os' ) {console.log("start plot suggesties");  plotSuggesties(deelfietsSuggesties);}
    if (Instellingen.haltes) {
      console.log("start plot haltes");  
      labels =["latlon", "haltenaam", "ov-niveau", "id-gtfs", "cbs-vrk500", "pc4", "woonplaats", "gemeente", "rank-1.5km", "rank-3km", "fiets-score", "fiets-rank-1.5km", "fiets-rank-3km", "nearby-fiets-rank1-1.5km", "nearby-fiets-rank1-3km", "ov-score", "ov-rank-1.5km", "ov-rank-3km", "nearby-ov-rank1-1.5km", "nearby-ov-rank1-3km"]
      console.log("start plot haltes");  plotHaltesArray(haltes);;}

    if (Instellingen.par ){ 
      console.log("vierantstatistiek plotten")
      kolom = parseInt(Instellingen.par) // bepaal kolom die kleur bepaald
      plotVierkanten4(vkdata,kolom,0); //vulling doet
      }

    if (Instellingen['live']  ){ 
      leg ='Aantal bij Hub<br>';
      for (let i in verloopRoodGroen) {
        strx  = verloopLeg[i];
        leg += '<i style=" opacity: 0.8; background-color:' + verloopRoodGroen[i] + '; text-align: center"></i><span>'+strx +'</span><BR>' ;
        }
      Instellingen.legenda.titel = "Donkey beschikbaarheid"
      //Instellingen.legend.minWidth = '300px'
      //Instellingen.legend.html = leg
      getInfo();
       }
    if (Instellingen["pointer"] !=null) {plaatsPointer();}
    if (Instellingen["i"] =='c') {map.on('click', onMapClick);}
    console.log("Start legenda plotten")
    if (Instellingen.par ){ ontwerpLegenda(Instellingen.legenda,kolom)} else { maakLegenda(Instellingen.legenda);} 

    }
  window.onload = windowGeladen;
 
  </script>
 </body>
</html>
